# Test info

- Name: Checking permissions >> Check UI Internal Writer permission
- Location: /home/runner/work/qa-automated-tests/qa-automated-tests/tests/ngf.test.js:563:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeVisible()

Locator: getByTestId('create-button')
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for getByTestId('create-button')

    at /home/runner/work/qa-automated-tests/qa-automated-tests/tests/ngf.test.js:573:55
    at /home/runner/work/qa-automated-tests/qa-automated-tests/tests/ngf.test.js:572:16
```

# Page snapshot

```yaml
- link "Mobalytics":
  - /url: /poe-2
  - img "Mobalytics"
- link "League of Legends LoL":
  - /url: https://stg.mobalytics.gg/lol
  - img "League of Legends"
  - text: LoL
- link "Teamfight Tactics TFT":
  - /url: https://stg.mobalytics.gg/tft
  - img "Teamfight Tactics"
  - text: TFT
- link "Path of Exile 2 PoE 2":
  - /url: https://stg.mobalytics.gg/poe-2
  - img "Path of Exile 2"
  - text: PoE 2
- link "Diablo 4 Diablo 4":
  - /url: https://stg.mobalytics.gg/diablo-4
  - img "Diablo 4"
  - text: Diablo 4
- link "Elden Ring Nightreign Nightreign New":
  - /url: https://stg.mobalytics.gg/elden-ring-nightreign
  - img "Elden Ring Nightreign"
  - text: Nightreign New
- link "Deadlock Deadlock":
  - /url: https://stg.mobalytics.gg/deadlock
  - img "Deadlock"
  - text: Deadlock
- link "Valorant VAL":
  - /url: https://stg.mobalytics.gg/valorant
  - img "Valorant"
  - text: VAL
- link "Monster Hunter Wilds Monster Hunter Wilds":
  - /url: https://stg.mobalytics.gg/mhw
  - img "Monster Hunter Wilds"
  - text: Monster Hunter Wilds
- link "Destiny 2 Destiny 2":
  - /url: https://stg.mobalytics.gg/destiny-2
  - img "Destiny 2"
  - text: Destiny 2
- link "Lost Ark Lost Ark":
  - /url: https://stg.mobalytics.gg/lost-ark
  - img "Lost Ark"
  - text: Lost Ark
- button:
  - img
- link "Example game ExG":
  - /url: https://stg.mobalytics.gg/example-game
  - img "Example game"
  - text: ExG
- link "The Bazaar The Bazaar":
  - /url: https://stg.mobalytics.gg/the-bazaar
  - img "The Bazaar"
  - text: The Bazaar
- link "Marvel Rivals Marvel Rivals":
  - /url: https://stg.mobalytics.gg/marvel-rivals
  - img "Marvel Rivals"
  - text: Marvel Rivals
- link "Zenless Zone Zero ZZZ New":
  - /url: https://stg.mobalytics.gg/zzz
  - img "Zenless Zone Zero"
  - text: ZZZ New
- link "win logo Download app":
  - /url: /lol/glp/download-welcome?Channel=web_dl_btn&utm_campaign=top-poe-2&utm_medium=homepage&utm_source=web
  - button "win logo Download app":
    - img "win logo"
    - text: Download app
- img
- textbox "global search input"
- text: Community
- button "Remove Ads"
- img "settings"
- img "support"
- link "Home":
  - /url: /poe-2
  - img "Home"
- link "Profile":
  - /url: /poe-2/profile
  - img "Profile"
- link "Build Planner":
  - /url: /poe-2/planner/builds
  - img "Build Planner"
- link "Tier List":
  - /url: /poe-2/tier-list
  - img "Tier List"
- link "Starter Builds":
  - /url: /poe-2/starter-builds
  - img "Starter Builds"
- link "Builds":
  - /url: /poe-2/builds
  - img "Builds"
- link "Creators":
  - /url: /poe-2/creators
  - img "Creators"
- link "Guides":
  - /url: /poe-2/guides
  - img "Guides"
- main:
  - heading "404" [level=1]
  - heading "The page you are looking for is not found" [level=2]
  - paragraph: There may have been an error or the link you tried may be broken.
- complementary: Remove Ads
- banner: Advertisement Remove Ads
- text: Remove all ads Say goodbye to ads, support our team, see exclusive sneak peeks, and get a shiny new Discord role.
- button "Remove ads"
- button "Do Not Sell or Share My Personal Information":
  - paragraph: Do Not Sell or Share My Personal Information
```

# Test source

```ts
  473 |     const moba = new Moba(page);
  474 |
  475 |     await moba.mainURLs.openUgStgMarvelRivalsPage();
  476 |     await moba.ugProfilePage.gotoGuidePlannerPage();
  477 |     await moba.ugBuildPage.createGuide(pageName);
  478 |
  479 |     await test.step(`Expected Result: Guide page with the name: ${pageName} is created on Marvel Rivals project`, async () => {
  480 |       await expect(moba.ugBuildPage.header).toContainText(
  481 |         "Marvel Rivals Guide"
  482 |       );
  483 |       await expect(moba.ugBuildPage.controlPanel).toContainText(pageName);
  484 |     });
  485 |   });
  486 |
  487 |   test(`Create a guide page on ZZZ project`, async ({ apiAuthAdmin, page }) => {
  488 |     await page.context().addCookies(apiAuthAdmin.cookies);
  489 |     const uniqueId = uuidv4();
  490 |     const pageName = `qa-automation-guide-page-${uniqueId}`;
  491 |     const moba = new Moba(page);
  492 |
  493 |     await moba.mainURLs.openUgStgZzzPage();
  494 |     await moba.ugProfilePage.gotoGuidePlannerPage();
  495 |     await moba.ugBuildPage.createGuide(pageName);
  496 |
  497 |     await test.step(`Expected Result: Guide page with the name: ${pageName} is created on ZZZ project`, async () => {
  498 |       await expect(moba.ugBuildPage.header).toContainText("ZZZ Guide");
  499 |       await expect(moba.ugBuildPage.controlPanel).toContainText(pageName);
  500 |     });
  501 |   });
  502 |
  503 |   test(`Create a team page on ZZZ project`, async ({ apiAuthAdmin, page }) => {
  504 |     await page.context().addCookies(apiAuthAdmin.cookies);
  505 |     const uniqueId = uuidv4();
  506 |     const pageName = `qa-automation-team-page-${uniqueId}`;
  507 |     const moba = new Moba(page);
  508 |
  509 |     await moba.mainURLs.openUgStgZzzPage();
  510 |     await moba.ugProfilePage.gotoTeamPlannerPage();
  511 |     await moba.ugBuildPage.createGuide(pageName);
  512 |
  513 |     await test.step(`Expected Result: Team page with the name: ${pageName} is created on ZZZ project`, async () => {
  514 |       await expect(moba.ugBuildPage.header).toContainText("ZZZ Team");
  515 |       await expect(moba.ugBuildPage.controlPanel).toContainText(pageName);
  516 |     });
  517 |   });
  518 | });
  519 |
  520 | test.describe("Checking permissions", () => {
  521 |   test("Check UI admin permission", async ({ page, apiAuthAdmin }) => {
  522 |     await page.context().addCookies(apiAuthAdmin.cookies);
  523 |     const moba = new Moba(page);
  524 |     const title = "Structure Pages";
  525 |
  526 |     await moba.mainURLs.openAdminStgPoePage();
  527 |     await test.step(`User is logged in`, async () => {
  528 |       await expect(moba.stAdminPage.createPageButton).toBeVisible();
  529 |       await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
  530 |     });
  531 |   });
  532 |
  533 |   test("Check API admin permission", async ({ request, apiAuthAdmin }) => {
  534 |     const adminRoleResponse = await request.post(
  535 |       "https://stg.mobalytics.gg/api/poe-2/v1/graphql/query",
  536 |       {
  537 |         data: {
  538 |           query: `
  539 |             query Poe2 {
  540 |                 poe2 {
  541 |                     id
  542 |                     permissions {
  543 |                         user {
  544 |                             id
  545 |                             role
  546 |                         }
  547 |                     }
  548 |                 }
  549 |             }
  550 |         `,
  551 |         },
  552 |         headers: {
  553 |           "Content-Type": "application/json",
  554 |         },
  555 |       }
  556 |     );
  557 |     expect(adminRoleResponse.ok()).toBeTruthy();
  558 |     const json = await adminRoleResponse.json();
  559 |     const role = json.data.poe2.permissions.user.role;
  560 |     expect(role).toBe("ADMIN");
  561 |   });
  562 |
  563 |   test("Check UI Internal Writer permission", async ({
  564 |     page,
  565 |     apiAuthInternalWriter,
  566 |   }) => {
  567 |     await page.context().addCookies(apiAuthInternalWriter.cookies);
  568 |     const moba = new Moba(page);
  569 |     const title = "Structure Pages";
  570 |
  571 |     await moba.mainURLs.openAdminStgPoePage();
  572 |     await test.step(`User is logged in`, async () => {
> 573 |       await expect(moba.stAdminPage.createPageButton).toBeVisible();
      |                                                       ^ Error: Timed out 5000ms waiting for expect(locator).toBeVisible()
  574 |       await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
  575 |     });
  576 |   });
  577 |
  578 |   test("Check API Internal Writer permission", async ({
  579 |     request,
  580 |     apiAuthInternalWriter,
  581 |   }) => {
  582 |     const adminRoleResponse = await request.post(
  583 |       "https://stg.mobalytics.gg/api/poe-2/v1/graphql/query",
  584 |       {
  585 |         data: {
  586 |           query: `
  587 |             query Poe2 {
  588 |                 poe2 {
  589 |                     id
  590 |                     permissions {
  591 |                         user {
  592 |                             id
  593 |                             role
  594 |                         }
  595 |                     }
  596 |                 }
  597 |             }
  598 |         `,
  599 |         },
  600 |         headers: {
  601 |           "Content-Type": "application/json",
  602 |         },
  603 |       }
  604 |     );
  605 |     expect(adminRoleResponse.ok()).toBeTruthy();
  606 |     const json = await adminRoleResponse.json();
  607 |     const role = json.data.poe2.permissions.user.role;
  608 |     expect(role).toBe("INTERNAL_WRITER");
  609 |   });
  610 |
  611 |   test("Check UI Game Manager permission", async ({
  612 |     page,
  613 |     apiAuthGameManager,
  614 |   }) => {
  615 |     await page.context().addCookies(apiAuthGameManager.cookies);
  616 |     const moba = new Moba(page);
  617 |     const title = "Structure Pages";
  618 |
  619 |     await moba.mainURLs.openAdminStgPoePage();
  620 |     await test.step(`User is logged in`, async () => {
  621 |       await expect(moba.stAdminPage.createPageButton).toBeVisible();
  622 |       await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
  623 |     });
  624 |   });
  625 |
  626 |   test("Check API Game Manager permission", async ({
  627 |     request,
  628 |     apiAuthGameManager,
  629 |   }) => {
  630 |     const adminRoleResponse = await request.post(
  631 |       "https://stg.mobalytics.gg/api/poe-2/v1/graphql/query",
  632 |       {
  633 |         data: {
  634 |           query: `
  635 |             query Poe2 {
  636 |                 poe2 {
  637 |                     id
  638 |                     permissions {
  639 |                         user {
  640 |                             id
  641 |                             role
  642 |                         }
  643 |                     }
  644 |                 }
  645 |             }
  646 |         `,
  647 |         },
  648 |         headers: {
  649 |           "Content-Type": "application/json",
  650 |         },
  651 |       }
  652 |     );
  653 |     expect(adminRoleResponse.ok()).toBeTruthy();
  654 |     const json = await adminRoleResponse.json();
  655 |     const role = json.data.poe2.permissions.user.role;
  656 |     expect(role).toBe("GAME_MANAGER");
  657 |   });
  658 | });
  659 |
```