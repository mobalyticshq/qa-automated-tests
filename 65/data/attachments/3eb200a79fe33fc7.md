# Test info

- Name: Checking role permissions >> Game Manager permission >> Game Manager role can't publish ST pages
- Location: /home/runner/work/qa-automated-tests/qa-automated-tests/e2e-tests/tests/ngf.test.js:897:9

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).not.toContainText(expected)

Locator: getByTestId('document-controls-panel')
Expected string: not "Published"
Received: <element(s) not found>
Call log:
  - expect.not.toContainText with timeout 5000ms
  - waiting for getByTestId('document-controls-panel')

    at /home/runner/work/qa-automated-tests/qa-automated-tests/e2e-tests/tests/ngf.test.js:910:52
    at /home/runner/work/qa-automated-tests/qa-automated-tests/e2e-tests/tests/ngf.test.js:909:18
```

# Page snapshot

```yaml
- link "Mobalytics":
  - /url: /zzz
  - img "Mobalytics"
- link "League of Legends LoL":
  - /url: https://stg.mobalytics.gg/lol
  - img "League of Legends"
  - text: LoL
- link "Teamfight Tactics TFT":
  - /url: https://stg.mobalytics.gg/tft
  - img "Teamfight Tactics"
  - text: TFT
- link "Path of Exile 2 PoE 2":
  - /url: https://stg.mobalytics.gg/poe-2
  - img "Path of Exile 2"
  - text: PoE 2
- link "Diablo 4 Diablo 4":
  - /url: https://stg.mobalytics.gg/diablo-4
  - img "Diablo 4"
  - text: Diablo 4
- link "Elden Ring Nightreign Nightreign New":
  - /url: https://stg.mobalytics.gg/elden-ring-nightreign
  - img "Elden Ring Nightreign"
  - text: Nightreign New
- link "Deadlock Deadlock":
  - /url: https://stg.mobalytics.gg/deadlock
  - img "Deadlock"
  - text: Deadlock
- link "Valorant VAL":
  - /url: https://stg.mobalytics.gg/valorant
  - img "Valorant"
  - text: VAL
- link "Monster Hunter Wilds Monster Hunter Wilds":
  - /url: https://stg.mobalytics.gg/mhw
  - img "Monster Hunter Wilds"
  - text: Monster Hunter Wilds
- link "Destiny 2 Destiny 2":
  - /url: https://stg.mobalytics.gg/destiny-2
  - img "Destiny 2"
  - text: Destiny 2
- link "Lost Ark Lost Ark":
  - /url: https://stg.mobalytics.gg/lost-ark
  - img "Lost Ark"
  - text: Lost Ark
- button:
  - img
- link "Example game ExG":
  - /url: https://stg.mobalytics.gg/example-game
  - img "Example game"
  - text: ExG
- link "The Bazaar The Bazaar":
  - /url: https://stg.mobalytics.gg/the-bazaar
  - img "The Bazaar"
  - text: The Bazaar
- link "Marvel Rivals Marvel Rivals":
  - /url: https://stg.mobalytics.gg/marvel-rivals
  - img "Marvel Rivals"
  - text: Marvel Rivals
- link "Zenless Zone Zero ZZZ New":
  - /url: https://stg.mobalytics.gg/zzz
  - img "Zenless Zone Zero"
  - text: ZZZ New
- link "win logo Download app":
  - /url: /lol/glp/download-welcome?Channel=web_dl_btn&utm_campaign=top-zzz&utm_medium=homepage&utm_source=web
  - button "win logo Download app":
    - img "win logo"
    - text: Download app
- text: Community
- button "Remove Ads"
- img "settings"
- img "support"
- link "Home":
  - /url: /zzz
  - img "Home"
- link "Profile":
  - /url: /zzz/profile
  - img "Profile"
- link "Characters":
  - /url: /zzz/characters
  - img "Characters"
- link "Builds":
  - /url: /zzz/builds
  - img "Builds"
- link "Tier List":
  - /url: /zzz/tier-list
  - img "Tier List"
- link "W-Engines":
  - /url: /zzz/w-engines
  - img "W-Engines"
- link "Drive Discs":
  - /url: /zzz/drive-discs
  - img "Drive Discs"
- link "Bangboos":
  - /url: /zzz/bangboos
  - img "Bangboos"
- link "Guides":
  - /url: /zzz/guides
  - img "Guides"
- main
- complementary: Remove Ads
- banner: Advertisement Remove Ads
- text: Remove all ads Say goodbye to ads, support our team, see exclusive sneak peeks, and get a shiny new Discord role.
- button "Remove ads"
- button "Do Not Sell or Share My Personal Information":
  - paragraph: Do Not Sell or Share My Personal Information
```

# Test source

```ts
   810 |       const adminRoleResponse = await request.post(
   811 |         `${baseURL}/api/poe-2/v1/graphql/query`,
   812 |         {
   813 |           data: {
   814 |             query: `
   815 |             query Poe2 {
   816 |                 poe2 {
   817 |                     id
   818 |                     permissions {
   819 |                         user {
   820 |                             id
   821 |                             role
   822 |                         }
   823 |                     }
   824 |                 }
   825 |             }
   826 |         `,
   827 |           },
   828 |           headers: {
   829 |             "Content-Type": "application/json",
   830 |           },
   831 |         }
   832 |       );
   833 |       expect(adminRoleResponse.ok()).toBeTruthy();
   834 |       const json = await adminRoleResponse.json();
   835 |       const role = json.data.poe2.permissions.user.role;
   836 |       expect(role).toBe("INTERNAL_WRITER");
   837 |     });
   838 |   });
   839 |
   840 |   test.describe("Game Manager permission", () => {
   841 |     test("Game Manager role has access to the Admin ST page", async ({
   842 |       page,
   843 |       apiAuthGameManager,
   844 |       baseURL,
   845 |     }) => {
   846 |       await page.context().addCookies(apiAuthGameManager.cookies);
   847 |       const moba = new Moba(page);
   848 |       const title = "Structure Pages";
   849 |
   850 |       await moba.mainURLs.openAdminPoePage(baseURL);
   851 |       await test.step(`User is logged in`, async () => {
   852 |         await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
   853 |       });
   854 |     });
   855 |
   856 |     test('St Widget contains only "Edit" button & "Create Page" button is missing on ST page for Game Manager role', async ({
   857 |       page,
   858 |       apiAuthGameManager,
   859 |       baseURL,
   860 |     }) => {
   861 |       await page.context().addCookies(apiAuthGameManager.cookies);
   862 |       const moba = new Moba(page);
   863 |       let stWidgetName = "/qa-not-delete-st-page";
   864 |
   865 |       await moba.mainURLs.openAdminNightreignPage(baseURL);
   866 |
   867 |       await test.step('Expected Result: St Widget contains "Edit" button', async () => {
   868 |         await expect(moba.stAdminPage.editButton(stWidgetName)).toBeVisible();
   869 |       });
   870 |       await test.step('Expected Result: St Widget contains "Delete" button', async () => {
   871 |         await expect(
   872 |           moba.stAdminPage.deleteButton(stWidgetName)
   873 |         ).not.toBeVisible();
   874 |       });
   875 |       await test.step('Expected Result: "Create Page" button is missing on ST page for Game Manager role', async () => {
   876 |         await expect(moba.stAdminPage.createPageButton).not.toBeVisible();
   877 |       });
   878 |     });
   879 |
   880 |     test(`View mode of the "/qa-not-delete-st-page" structure page is available for the Game Manager role`, async ({
   881 |       apiAuthGameManager,
   882 |       page,
   883 |       baseURL,
   884 |     }) => {
   885 |       await page.context().addCookies(apiAuthGameManager.cookies);
   886 |       let stWidgetName = "/qa-not-delete-st-page";
   887 |
   888 |       const moba = new Moba(page);
   889 |
   890 |       await moba.mainURLs.openAdminNightreignPage(baseURL);
   891 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
   892 |       await test.step(`Expected Result: View mode the "/home" structure page is opened`, async () => {
   893 |         await expect(moba.stPage.stPageTitle).toContainText(stWidgetName);
   894 |       });
   895 |     });
   896 |
   897 |     test(`Game Manager role can't publish ST pages`, async ({
   898 |       apiAuthGameManager,
   899 |       page,
   900 |       baseURL,
   901 |     }) => {
   902 |       await page.context().addCookies(apiAuthGameManager.cookies);
   903 |       let stWidgetName = "/qa-not-delete-st-page";
   904 |
   905 |       const moba = new Moba(page);
   906 |
   907 |       await moba.mainURLs.openAdminZzzPage(baseURL);
   908 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
   909 |       await test.step(`Expected Result: "Publish" button is missing in the control panel on the ST page`, async () => {
>  910 |         await expect(moba.stPage.controlPanel).not.toContainText("Published");
       |                                                    ^ Error: Timed out 5000ms waiting for expect(locator).not.toContainText(expected)
   911 |       });
   912 |     });
   913 |
   914 |     test(`Game Manager role can't archive, duplicate ST pages`, async ({
   915 |       apiAuthGameManager,
   916 |       page,
   917 |       baseURL,
   918 |     }) => {
   919 |       await page.context().addCookies(apiAuthGameManager.cookies);
   920 |       let stWidgetName = "/qa-not-delete-st-page";
   921 |
   922 |       const moba = new Moba(page);
   923 |
   924 |       await moba.mainURLs.openAdminZzzPage(baseURL);
   925 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
   926 |       await test.step(`Expected Result: "Dots" button is missing in the control panel on the ST page`, async () => {
   927 |         await expect(moba.stPage.dotsButton).not.toBeVisible();
   928 |       });
   929 |     });
   930 |
   931 |     test(`Game Manager has access to SEO modal on the structure pages`, async ({
   932 |       apiAuthGameManager,
   933 |       page,
   934 |       baseURL,
   935 |     }) => {
   936 |       await page.context().addCookies(apiAuthGameManager.cookies);
   937 |       const moba = new Moba(page);
   938 |       let stWidgetName = "/qa-not-delete-st-page";
   939 |
   940 |       await moba.mainURLs.openAdminZzzPage(baseURL);
   941 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
   942 |       await moba.stPage.openSeoModal();
   943 |
   944 |       await test.step(`Expected Result: SEO modal is available for Game Manager role`, async () => {
   945 |         await expect(moba.stPage.seoModal).toBeVisible();
   946 |       });
   947 |     });
   948 |
   949 |     // test(`Game Manager role can add VideoV2 widget (link) to the structure pages`, async ({
   950 |     //   apiAuthGameManager,
   951 |     //   page,
   952 |     // }) => {
   953 |     //   await page.context().addCookies(apiAuthGameManager.cookies);
   954 |     //   const uniqueId = uuidv4();
   955 |     //   const pageName = `/qa-automation-game-manager`;
   956 |     //   const moba = new Moba(page);
   957 |     //   let link = "https://youtu.be/g-qkY2yj4_A?si=senOMRXZQu9DivSQ";
   958 |
   959 |     //   await moba.mainURLs.openAdminMhwPage();
   960 |     //   await moba.stAdminPage.clickOnStWidget(stWidgetName);
   961 |     //   await moba.stPage.addHeaderV2Widget();
   962 |     //   await moba.stPage.addVideoV2Widget(link);
   963 |     //   await moba.stPage.createStPage(pageName);
   964 |     //   cleanupStMhwPages.addPageForCleanup(pageName); // Register page for deleting
   965 |
   966 |     //   await test.step(`Expected Result: VideoV2 widget is present in the ST page`, async () => {
   967 |     //     await expect(moba.stPage.videoV2Widget).toBeVisible();
   968 |     //   });
   969 |     // });
   970 |
   971 |     // test(`Admin role can add image into widgets (link) to the structure pages`, async ({
   972 |     //   apiAuthAdmin,
   973 |     //   page,
   974 |     //   cleanupStZzzPages,
   975 |     // }) => {
   976 |     //   await page.context().addCookies(apiAuthAdmin.cookies);
   977 |     //   const uniqueId = uuidv4();
   978 |     //   const pageName = `/qa-automation-st-page-${uniqueId}`;
   979 |     //   const moba = new Moba(page);
   980 |     //   let link =
   981 |     //     "https://cdn.mobalytics.gg/cdn-cgi/image/format=auto,width=1150/assets/diablo-4/images/background-images/classes/sorcerer.jpg";
   982 |
   983 |     //   await moba.mainURLs.openAdminZzzPage();
   984 |     //   await moba.stAdminPage.gotoStPlannerPage();
   985 |     //   await moba.stPage.addCardGalleryV2Widget();
   986 |     //   await moba.cardGalleryV2Widget.addImageLink(link);
   987 |     //   await moba.stPage.createStPage(pageName);
   988 |     //   cleanupStZzzPages.addPageForCleanup(pageName); // Register page for deleting
   989 |
   990 |     //   await test.step(`Expected Result: Image is present in the Card GalleryV2 widget on ST page`, async () => {
   991 |     //     await expect(
   992 |     //       moba.cardGalleryV2Widget.сardGalleryV2Widget
   993 |     //     ).toBeVisible();
   994 |     //   });
   995 |     // });
   996 |
   997 |     // test(`Game Manager role can edit the structure page`, async ({
   998 |     //   apiAuthGameManager,
   999 |     //   page,
  1000 |     //   cleanupStZzzPages,
  1001 |     // }) => {
  1002 |     //   await page.context().addCookies(apiAuthGameManager.cookies);
  1003 |     //   const uniqueId = uuidv4();
  1004 |     //   const pageName = `/qa-game-manager-edit-function`;
  1005 |     //   const moba = new Moba(page);
  1006 |
  1007 |     //   await moba.mainURLs.openAdminZzzPage();
  1008 |     //   await moba.stAdminPage.clickOnStWidget(pageName);
  1009 |
  1010 |     //   await moba.stPage.createStPage(pageName);
```