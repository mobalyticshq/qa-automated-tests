# Test info

- Name: Checking permissions >> Check UI Internal Writer permission
- Location: /home/runner/work/qa-automated-tests/qa-automated-tests/tests/ngf.test.js:562:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeVisible()

Locator: getByTestId('create-button')
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for getByTestId('create-button')

    at /home/runner/work/qa-automated-tests/qa-automated-tests/tests/ngf.test.js:572:55
    at /home/runner/work/qa-automated-tests/qa-automated-tests/tests/ngf.test.js:571:16
```

# Page snapshot

```yaml
- link "Mobalytics":
  - /url: /poe-2
  - img "Mobalytics"
- link "League of Legends LoL":
  - /url: https://stg.mobalytics.gg/lol
  - img "League of Legends"
  - text: LoL
- link "Teamfight Tactics TFT":
  - /url: https://stg.mobalytics.gg/tft
  - img "Teamfight Tactics"
  - text: TFT
- link "Path of Exile 2 PoE 2":
  - /url: https://stg.mobalytics.gg/poe-2
  - img "Path of Exile 2"
  - text: PoE 2
- link "Diablo 4 Diablo 4":
  - /url: https://stg.mobalytics.gg/diablo-4
  - img "Diablo 4"
  - text: Diablo 4
- link "Elden Ring Nightreign Nightreign New":
  - /url: https://stg.mobalytics.gg/elden-ring-nightreign
  - img "Elden Ring Nightreign"
  - text: Nightreign New
- link "Deadlock Deadlock":
  - /url: https://stg.mobalytics.gg/deadlock
  - img "Deadlock"
  - text: Deadlock
- link "Valorant VAL":
  - /url: https://stg.mobalytics.gg/valorant
  - img "Valorant"
  - text: VAL
- link "Monster Hunter Wilds Monster Hunter Wilds":
  - /url: https://stg.mobalytics.gg/mhw
  - img "Monster Hunter Wilds"
  - text: Monster Hunter Wilds
- link "Destiny 2 Destiny 2":
  - /url: https://stg.mobalytics.gg/destiny-2
  - img "Destiny 2"
  - text: Destiny 2
- link "Lost Ark Lost Ark":
  - /url: https://stg.mobalytics.gg/lost-ark
  - img "Lost Ark"
  - text: Lost Ark
- button:
  - img
- link "Example game ExG":
  - /url: https://stg.mobalytics.gg/example-game
  - img "Example game"
  - text: ExG
- link "The Bazaar The Bazaar":
  - /url: https://stg.mobalytics.gg/the-bazaar
  - img "The Bazaar"
  - text: The Bazaar
- link "Marvel Rivals Marvel Rivals":
  - /url: https://stg.mobalytics.gg/marvel-rivals
  - img "Marvel Rivals"
  - text: Marvel Rivals
- link "Zenless Zone Zero ZZZ New":
  - /url: https://stg.mobalytics.gg/zzz
  - img "Zenless Zone Zero"
  - text: ZZZ New
- link "win logo Download app":
  - /url: /lol/glp/download-welcome?Channel=web_dl_btn&utm_campaign=top-poe-2&utm_medium=homepage&utm_source=web
  - button "win logo Download app":
    - img "win logo"
    - text: Download app
- img
- textbox "global search input"
- text: Community
- button "Remove Ads"
- img "settings"
- img "support"
- link "Home":
  - /url: /poe-2
  - img "Home"
- link "Profile":
  - /url: /poe-2/profile
  - img "Profile"
- link "Build Planner":
  - /url: /poe-2/planner/builds
  - img "Build Planner"
- link "Tier List":
  - /url: /poe-2/tier-list
  - img "Tier List"
- link "Starter Builds":
  - /url: /poe-2/starter-builds
  - img "Starter Builds"
- link "Builds":
  - /url: /poe-2/builds
  - img "Builds"
- link "Creators":
  - /url: /poe-2/creators
  - img "Creators"
- link "Guides":
  - /url: /poe-2/guides
  - img "Guides"
- main:
  - heading "404" [level=1]
  - heading "The page you are looking for is not found" [level=2]
  - paragraph: There may have been an error or the link you tried may be broken.
- complementary: Remove Ads
- banner: Advertisement Remove Ads
- text: Remove all ads Say goodbye to ads, support our team, see exclusive sneak peeks, and get a shiny new Discord role.
- button "Remove ads"
- button "Do Not Sell or Share My Personal Information":
  - paragraph: Do Not Sell or Share My Personal Information
```

# Test source

```ts
  472 |     const moba = new Moba(page);
  473 |
  474 |     await moba.mainURLs.openUgStgMarvelRivalsPage();
  475 |     await moba.ugProfilePage.gotoGuidePlannerPage();
  476 |     await moba.ugBuildPage.createGuide(pageName);
  477 |
  478 |     await test.step(`Expected Result: Guide page with the name: ${pageName} is created on Marvel Rivals project`, async () => {
  479 |       await expect(moba.ugBuildPage.header).toContainText(
  480 |         "Marvel Rivals Guide"
  481 |       );
  482 |       await expect(moba.ugBuildPage.controlPanel).toContainText(pageName);
  483 |     });
  484 |   });
  485 |
  486 |   test(`Create a guide page on ZZZ project`, async ({ apiAuthAdmin, page }) => {
  487 |     await page.context().addCookies(apiAuthAdmin.cookies);
  488 |     const uniqueId = uuidv4();
  489 |     const pageName = `qa-automation-guide-page-${uniqueId}`;
  490 |     const moba = new Moba(page);
  491 |
  492 |     await moba.mainURLs.openUgStgZzzPage();
  493 |     await moba.ugProfilePage.gotoGuidePlannerPage();
  494 |     await moba.ugBuildPage.createGuide(pageName);
  495 |
  496 |     await test.step(`Expected Result: Guide page with the name: ${pageName} is created on ZZZ project`, async () => {
  497 |       await expect(moba.ugBuildPage.header).toContainText("ZZZ Guide");
  498 |       await expect(moba.ugBuildPage.controlPanel).toContainText(pageName);
  499 |     });
  500 |   });
  501 |
  502 |   test(`Create a team page on ZZZ project`, async ({ apiAuthAdmin, page }) => {
  503 |     await page.context().addCookies(apiAuthAdmin.cookies);
  504 |     const uniqueId = uuidv4();
  505 |     const pageName = `qa-automation-team-page-${uniqueId}`;
  506 |     const moba = new Moba(page);
  507 |
  508 |     await moba.mainURLs.openUgStgZzzPage();
  509 |     await moba.ugProfilePage.gotoTeamPlannerPage();
  510 |     await moba.ugBuildPage.createGuide(pageName);
  511 |
  512 |     await test.step(`Expected Result: Team page with the name: ${pageName} is created on ZZZ project`, async () => {
  513 |       await expect(moba.ugBuildPage.header).toContainText("ZZZ Team");
  514 |       await expect(moba.ugBuildPage.controlPanel).toContainText(pageName);
  515 |     });
  516 |   });
  517 | });
  518 |
  519 | test.describe("Checking permissions", () => {
  520 |   test("Check UI admin permission", async ({ page, apiAuthAdmin }) => {
  521 |     await page.context().addCookies(apiAuthAdmin.cookies);
  522 |     const moba = new Moba(page);
  523 |     const title = "Structure Pages";
  524 |
  525 |     await moba.mainURLs.openAdminStgPoePage();
  526 |     await test.step(`User is logged in`, async () => {
  527 |       await expect(moba.stAdminPage.createPageButton).toBeVisible();
  528 |       await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
  529 |     });
  530 |   });
  531 |
  532 |   test("Check API admin permission", async ({ request, apiAuthAdmin }) => {
  533 |     const adminRoleResponse = await request.post(
  534 |       "https://stg.mobalytics.gg/api/poe-2/v1/graphql/query",
  535 |       {
  536 |         data: {
  537 |           query: `
  538 |             query Poe2 {
  539 |                 poe2 {
  540 |                     id
  541 |                     permissions {
  542 |                         user {
  543 |                             id
  544 |                             role
  545 |                         }
  546 |                     }
  547 |                 }
  548 |             }
  549 |         `,
  550 |         },
  551 |         headers: {
  552 |           "Content-Type": "application/json",
  553 |         },
  554 |       }
  555 |     );
  556 |     expect(adminRoleResponse.ok()).toBeTruthy();
  557 |     const json = await adminRoleResponse.json();
  558 |     const role = json.data.poe2.permissions.user.role;
  559 |     expect(role).toBe("ADMIN");
  560 |   });
  561 |
  562 |   test("Check UI Internal Writer permission", async ({
  563 |     page,
  564 |     apiAuthInternalWriter,
  565 |   }) => {
  566 |     await page.context().addCookies(apiAuthInternalWriter.cookies);
  567 |     const moba = new Moba(page);
  568 |     const title = "Structure Pages";
  569 |
  570 |     await moba.mainURLs.openAdminStgPoePage();
  571 |     await test.step(`User is logged in`, async () => {
> 572 |       await expect(moba.stAdminPage.createPageButton).toBeVisible();
      |                                                       ^ Error: Timed out 5000ms waiting for expect(locator).toBeVisible()
  573 |       await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
  574 |     });
  575 |   });
  576 |
  577 |   test("Check API Internal Writer permission", async ({
  578 |     request,
  579 |     apiAuthInternalWriter,
  580 |   }) => {
  581 |     const adminRoleResponse = await request.post(
  582 |       "https://stg.mobalytics.gg/api/poe-2/v1/graphql/query",
  583 |       {
  584 |         data: {
  585 |           query: `
  586 |             query Poe2 {
  587 |                 poe2 {
  588 |                     id
  589 |                     permissions {
  590 |                         user {
  591 |                             id
  592 |                             role
  593 |                         }
  594 |                     }
  595 |                 }
  596 |             }
  597 |         `,
  598 |         },
  599 |         headers: {
  600 |           "Content-Type": "application/json",
  601 |         },
  602 |       }
  603 |     );
  604 |     expect(adminRoleResponse.ok()).toBeTruthy();
  605 |     const json = await adminRoleResponse.json();
  606 |     const role = json.data.poe2.permissions.user.role;
  607 |     expect(role).toBe("INTERNAL_WRITER");
  608 |   });
  609 |
  610 |   test("Check UI Game Manager permission", async ({
  611 |     page,
  612 |     apiAuthGameManager,
  613 |   }) => {
  614 |     await page.context().addCookies(apiAuthGameManager.cookies);
  615 |     const moba = new Moba(page);
  616 |     const title = "Structure Pages";
  617 |
  618 |     await moba.mainURLs.openAdminStgPoePage();
  619 |     await test.step(`User is logged in`, async () => {
  620 |       await expect(moba.stAdminPage.createPageButton).not.toBeVisible();
  621 |       await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
  622 |     });
  623 |   });
  624 |
  625 |   test("Check API Game Manager permission", async ({
  626 |     request,
  627 |     apiAuthGameManager,
  628 |   }) => {
  629 |     const adminRoleResponse = await request.post(
  630 |       "https://stg.mobalytics.gg/api/poe-2/v1/graphql/query",
  631 |       {
  632 |         data: {
  633 |           query: `
  634 |             query Poe2 {
  635 |                 poe2 {
  636 |                     id
  637 |                     permissions {
  638 |                         user {
  639 |                             id
  640 |                             role
  641 |                         }
  642 |                     }
  643 |                 }
  644 |             }
  645 |         `,
  646 |         },
  647 |         headers: {
  648 |           "Content-Type": "application/json",
  649 |         },
  650 |       }
  651 |     );
  652 |     expect(adminRoleResponse.ok()).toBeTruthy();
  653 |     const json = await adminRoleResponse.json();
  654 |     const role = json.data.poe2.permissions.user.role;
  655 |     expect(role).toBe("GAME_MANAGER");
  656 |   });
  657 | });
  658 |
```