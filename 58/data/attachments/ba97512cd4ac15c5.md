# Test info

- Name: Checking role permissions >> Checking Game Manager permission >> Game Manager role has access to the Admin ST page
- Location: /home/runner/work/qa-automated-tests/qa-automated-tests/e2e-tests/tests/ngf.test.js:831:9

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toContainText(expected)

Locator: getByRole('heading', { name: 'Structure Pages' })
Expected string: "Structure Pages"
Received: <element(s) not found>
Call log:
  - expect.toContainText with timeout 5000ms
  - waiting for getByRole('heading', { name: 'Structure Pages' })

    at /home/runner/work/qa-automated-tests/qa-automated-tests/e2e-tests/tests/ngf.test.js:842:60
    at /home/runner/work/qa-automated-tests/qa-automated-tests/e2e-tests/tests/ngf.test.js:841:18
```

# Page snapshot

```yaml
- link "Mobalytics":
  - /url: /poe-2
  - img "Mobalytics"
- link "League of Legends LoL":
  - /url: https://stg.mobalytics.gg/lol
  - img "League of Legends"
  - text: LoL
- link "Teamfight Tactics TFT":
  - /url: https://stg.mobalytics.gg/tft
  - img "Teamfight Tactics"
  - text: TFT
- link "Path of Exile 2 PoE 2":
  - /url: https://stg.mobalytics.gg/poe-2
  - img "Path of Exile 2"
  - text: PoE 2
- link "Diablo 4 Diablo 4":
  - /url: https://stg.mobalytics.gg/diablo-4
  - img "Diablo 4"
  - text: Diablo 4
- link "Elden Ring Nightreign Nightreign New":
  - /url: https://stg.mobalytics.gg/elden-ring-nightreign
  - img "Elden Ring Nightreign"
  - text: Nightreign New
- link "Deadlock Deadlock":
  - /url: https://stg.mobalytics.gg/deadlock
  - img "Deadlock"
  - text: Deadlock
- link "Valorant VAL":
  - /url: https://stg.mobalytics.gg/valorant
  - img "Valorant"
  - text: VAL
- link "Monster Hunter Wilds Monster Hunter Wilds":
  - /url: https://stg.mobalytics.gg/mhw
  - img "Monster Hunter Wilds"
  - text: Monster Hunter Wilds
- link "Destiny 2 Destiny 2":
  - /url: https://stg.mobalytics.gg/destiny-2
  - img "Destiny 2"
  - text: Destiny 2
- button:
  - img
- link "Lost Ark Lost Ark":
  - /url: https://stg.mobalytics.gg/lost-ark
  - img "Lost Ark"
  - text: Lost Ark
- link "Example game ExG":
  - /url: https://stg.mobalytics.gg/example-game
  - img "Example game"
  - text: ExG
- link "The Bazaar The Bazaar":
  - /url: https://stg.mobalytics.gg/the-bazaar
  - img "The Bazaar"
  - text: The Bazaar
- link "Marvel Rivals Marvel Rivals":
  - /url: https://stg.mobalytics.gg/marvel-rivals
  - img "Marvel Rivals"
  - text: Marvel Rivals
- link "Zenless Zone Zero ZZZ New":
  - /url: https://stg.mobalytics.gg/zzz
  - img "Zenless Zone Zero"
  - text: ZZZ New
- link "win logo Download app":
  - /url: /lol/glp/download-welcome?Channel=web_dl_btn&utm_campaign=top-poe-2&utm_medium=homepage&utm_source=web
  - button "win logo Download app":
    - img "win logo"
    - text: Download app
- img
- textbox "global search input"
- text: Community
- button "Remove Ads"
- img "settings"
- img "support"
- link "Home":
  - /url: /poe-2
  - img "Home"
- link "Profile":
  - /url: /poe-2/profile
  - img "Profile"
- link "Build Planner":
  - /url: /poe-2/planner/builds
  - img "Build Planner"
- link "Tier List":
  - /url: /poe-2/tier-list
  - img "Tier List"
- link "Starter Builds":
  - /url: /poe-2/starter-builds
  - img "Starter Builds"
- link "Builds":
  - /url: /poe-2/builds
  - img "Builds"
- link "Creators":
  - /url: /poe-2/creators
  - img "Creators"
- link "Guides":
  - /url: /poe-2/guides
  - img "Guides"
- main:
  - 'heading "error: something went terribly wrong..." [level=2]'
  - paragraph: Sorry for any inconvenience, we are trying our best but this is still work in progress and there might be issues.
- complementary: Remove Ads
- banner: Advertisement Remove Ads
- text: Remove all ads Say goodbye to ads, support our team, see exclusive sneak peeks, and get a shiny new Discord role.
- button "Remove ads"
```

# Test source

```ts
  742 |                 poe2 {
  743 |                     id
  744 |                     permissions {
  745 |                         user {
  746 |                             id
  747 |                             role
  748 |                         }
  749 |                     }
  750 |                 }
  751 |             }
  752 |         `,
  753 |           },
  754 |           headers: {
  755 |             "Content-Type": "application/json",
  756 |           },
  757 |         }
  758 |       );
  759 |       expect(adminRoleResponse.ok()).toBeTruthy();
  760 |       const json = await adminRoleResponse.json();
  761 |       const role = json.data.poe2.permissions.user.role;
  762 |       expect(role).toBe("ADMIN");
  763 |     });
  764 |   });
  765 |
  766 |   test.describe("Checking Internal Writer permission", () => {
  767 |     test(`Internal Writer role has NO access to the Admin ST page`, async ({
  768 |       apiAuthInternalWriter,
  769 |       page,
  770 |       baseURL,
  771 |     }) => {
  772 |       await page.context().addCookies(apiAuthInternalWriter.cookies);
  773 |       const moba = new Moba(page);
  774 |
  775 |       await moba.mainURLs.openAdminMhwPage(baseURL);
  776 |       await test.step(`Expected Result: Admin structure page is opened`, async () => {
  777 |         await expect(moba.stAdminPage.notFoundPage).toBeVisible();
  778 |       });
  779 |     });
  780 |
  781 |     test(`Internal Writer role has NO access to the control panel`, async ({
  782 |       apiAuthInternalWriter,
  783 |       page,
  784 |       baseURL,
  785 |     }) => {
  786 |       await page.context().addCookies(apiAuthInternalWriter.cookies);
  787 |       const moba = new Moba(page);
  788 |
  789 |       await moba.homePage.openMhwHomePage(baseURL);
  790 |       await test.step(`Expected Result: Control panel is missing for Internal Writer role`, async () => {
  791 |         await expect(moba.homePage.controlPanel).not.toBeVisible();
  792 |       });
  793 |     });
  794 |
  795 |     test("Check API Internal Writer permission", async ({
  796 |       request,
  797 |       apiAuthInternalWriter,
  798 |       baseURL,
  799 |     }) => {
  800 |       const adminRoleResponse = await request.post(
  801 |         `${baseURL}/api/poe-2/v1/graphql/query`,
  802 |         {
  803 |           data: {
  804 |             query: `
  805 |             query Poe2 {
  806 |                 poe2 {
  807 |                     id
  808 |                     permissions {
  809 |                         user {
  810 |                             id
  811 |                             role
  812 |                         }
  813 |                     }
  814 |                 }
  815 |             }
  816 |         `,
  817 |           },
  818 |           headers: {
  819 |             "Content-Type": "application/json",
  820 |           },
  821 |         }
  822 |       );
  823 |       expect(adminRoleResponse.ok()).toBeTruthy();
  824 |       const json = await adminRoleResponse.json();
  825 |       const role = json.data.poe2.permissions.user.role;
  826 |       expect(role).toBe("INTERNAL_WRITER");
  827 |     });
  828 |   });
  829 |
  830 |   test.describe("Checking Game Manager permission", () => {
  831 |     test("Game Manager role has access to the Admin ST page", async ({
  832 |       page,
  833 |       apiAuthGameManager,
  834 |       baseURL,
  835 |     }) => {
  836 |       await page.context().addCookies(apiAuthGameManager.cookies);
  837 |       const moba = new Moba(page);
  838 |       const title = "Structure Pages";
  839 |
  840 |       await moba.mainURLs.openAdminPoePage(baseURL);
  841 |       await test.step(`User is logged in`, async () => {
> 842 |         await expect(moba.stAdminPage.stAdminTitle(title)).toContainText(title);
      |                                                            ^ Error: Timed out 5000ms waiting for expect(locator).toContainText(expected)
  843 |       });
  844 |     });
  845 |
  846 |     test('St Widget contains only "Edit" button & "Create Page" button is missing on ST page for Game Manager role', async ({
  847 |       page,
  848 |       apiAuthGameManager,
  849 |       baseURL,
  850 |     }) => {
  851 |       await page.context().addCookies(apiAuthGameManager.cookies);
  852 |       const moba = new Moba(page);
  853 |       let stWidgetName = "/qa-not-delete-st-page";
  854 |
  855 |       await moba.mainURLs.openAdminNightreignPage(baseURL);
  856 |
  857 |       await test.step('Expected Result: St Widget contains "Edit" button', async () => {
  858 |         await expect(moba.stAdminPage.editButton(stWidgetName)).toBeVisible();
  859 |       });
  860 |       await test.step('Expected Result: St Widget contains "Delete" button', async () => {
  861 |         await expect(
  862 |           moba.stAdminPage.deleteButton(stWidgetName)
  863 |         ).not.toBeVisible();
  864 |       });
  865 |       await test.step('Expected Result: "Create Page" button is missing on ST page for Game Manager role', async () => {
  866 |         await expect(moba.stAdminPage.createPageButton).not.toBeVisible();
  867 |       });
  868 |     });
  869 |
  870 |     test(`View mode of the "/qa-not-delete-st-page" structure page is available for the Game Manager role`, async ({
  871 |       apiAuthGameManager,
  872 |       page,
  873 |       baseURL,
  874 |     }) => {
  875 |       await page.context().addCookies(apiAuthGameManager.cookies);
  876 |       let stWidgetName = "/qa-not-delete-st-page";
  877 |
  878 |       const moba = new Moba(page);
  879 |
  880 |       await moba.mainURLs.openAdminNightreignPage(baseURL);
  881 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
  882 |       await test.step(`Expected Result: View mode the "/home" structure page is opened`, async () => {
  883 |         await expect(moba.stPage.stPageTitle).toContainText(stWidgetName);
  884 |       });
  885 |     });
  886 |
  887 |     test(`Game Manager role can't publish ST pages`, async ({
  888 |       apiAuthGameManager,
  889 |       page,
  890 |       baseURL,
  891 |     }) => {
  892 |       await page.context().addCookies(apiAuthGameManager.cookies);
  893 |       let stWidgetName = "/qa-not-delete-st-page";
  894 |
  895 |       const moba = new Moba(page);
  896 |
  897 |       await moba.mainURLs.openAdminZzzPage(baseURL);
  898 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
  899 |       await test.step(`Expected Result: "Publish" button is missing in the control panel on the ST page`, async () => {
  900 |         await expect(moba.stPage.controlPanel).not.toContainText("Published");
  901 |       });
  902 |     });
  903 |
  904 |     test(`Game Manager role can't archive, duplicate ST pages`, async ({
  905 |       apiAuthGameManager,
  906 |       page,
  907 |       baseURL,
  908 |     }) => {
  909 |       await page.context().addCookies(apiAuthGameManager.cookies);
  910 |       let stWidgetName = "/qa-not-delete-st-page";
  911 |
  912 |       const moba = new Moba(page);
  913 |
  914 |       await moba.mainURLs.openAdminZzzPage(baseURL);
  915 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
  916 |       await test.step(`Expected Result: "Dots" button is missing in the control panel on the ST page`, async () => {
  917 |         await expect(moba.stPage.dotsButton).not.toBeVisible();
  918 |       });
  919 |     });
  920 |
  921 |     test(`Game Manager has access to SEO modal on the structure pages`, async ({
  922 |       apiAuthGameManager,
  923 |       page,
  924 |       baseURL,
  925 |     }) => {
  926 |       await page.context().addCookies(apiAuthGameManager.cookies);
  927 |       const moba = new Moba(page);
  928 |       let stWidgetName = "/qa-not-delete-st-page";
  929 |
  930 |       await moba.mainURLs.openAdminZzzPage(baseURL);
  931 |       await moba.stAdminPage.clickOnStWidget(stWidgetName);
  932 |       await moba.stPage.openSeoModal();
  933 |
  934 |       await test.step(`Expected Result: SEO modal is available for Game Manager role`, async () => {
  935 |         await expect(moba.stPage.seoModal).toBeVisible();
  936 |       });
  937 |     });
  938 |
  939 |     // test(`Game Manager role can add VideoV2 widget (link) to the structure pages`, async ({
  940 |     //   apiAuthGameManager,
  941 |     //   page,
  942 |     // }) => {
```